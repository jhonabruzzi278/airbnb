var x=(e,n,s)=>!e&&s?V(s):D(n),V=e=>{const n=e.userId,s=e.user,r=e.sessionId,o=e.sessionStatus,i=e.sessionClaims,t=e.session,m=e.organization,v=e.orgId,d=e.orgRole,a=e.orgPermissions,l=e.orgSlug,u=e.actor,T=e.factorVerificationAge;return{userId:n,user:s,sessionId:r,session:t,sessionStatus:o,sessionClaims:i,organization:m,orgId:v,orgRole:d,orgPermissions:a,orgSlug:l,actor:u,factorVerificationAge:T}},D=e=>{const n=e.user?e.user.id:e.user,s=e.user,r=e.session?e.session.id:e.session,o=e.session,i=e.session?.status,t=e.session?e.session.lastActiveToken?.jwt?.claims:null,m=e.session?e.session.factorVerificationAge:null,v=o?.actor,d=e.organization,a=e.organization?e.organization.id:e.organization,l=d?.slug,u=d&&s?.organizationMemberships?.find(C=>C.organization.id===a),T=u&&u.permissions,N=u&&u.role;return{userId:n,user:s,sessionId:r,session:o,sessionStatus:i,sessionClaims:t,organization:d,orgId:a,orgRole:N,orgSlug:l,orgPermissions:T,actor:v,factorVerificationAge:m}},P="METHOD_CALLED";function Q(e,n){return{event:P,payload:{method:e,...n}}}let c=[],g=0;const p=4;let I=0,z=e=>{let n=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},lc:0,listen(r){return s.lc=n.push(r),()=>{for(let i=g+p;i<c.length;)c[i]===r?c.splice(i,p):i+=p;let o=n.indexOf(r);~o&&(n.splice(o,1),--s.lc||s.off())}},notify(r,o){I++;let i=!c.length;for(let t of n)c.push(t,s.value,r,o);if(i){for(g=0;g<c.length;g+=p)c[g](c[g+1],c[g+2],c[g+3]);c.length=0}},off(){},set(r){let o=s.value;o!==r&&(s.value=r,s.notify(o))},subscribe(r){let o=s.listen(r);return r(s.value),o},value:e};return s};const F=5,h=6,E=10;let H=(e,n,s,r)=>(e.events=e.events||{},e.events[s+E]||(e.events[s+E]=r(o=>{e.events[s].reduceRight((i,t)=>(t(i),i),{shared:{},...o})})),e.events[s]=e.events[s]||[],e.events[s].push(n),()=>{let o=e.events[s],i=o.indexOf(n);o.splice(i,1),o.length||(delete e.events[s],e.events[s+E](),delete e.events[s+E])}),$=1e3,U=(e,n)=>H(e,r=>{let o=n(r);o&&e.events[h].push(o)},F,r=>{let o=e.listen;e.listen=(...t)=>(!e.lc&&!e.active&&(e.active=!0,r()),o(...t));let i=e.off;return e.events[h]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let t of e.events[h])t();e.events[h]=[]}},$)},()=>{e.listen=o,e.off=i}}),O=(e,n,s)=>{Array.isArray(e)||(e=[e]);let r,o,i=()=>{if(o===I)return;o=I;let a=e.map(l=>l.get());if(!r||a.some((l,u)=>l!==r[u])){r=a;let l=n(...a);l&&l.then&&l.t?l.then(u=>{r===a&&t.set(u)}):(t.set(l),o=I)}},t=z(void 0),m=t.get;t.get=()=>(i(),m());let v,d=s?()=>{clearTimeout(v),v=setTimeout(i)}:i;return U(t,()=>{let a=e.map(l=>l.listen(d));return i(),()=>{for(let l of a)l()}}),t},f=(e,n)=>O(e,n),q=(e,n)=>O(e,n,!0),R=(e={})=>{let n=z(e);return n.setKey=function(s,r){let o=n.value;typeof r>"u"&&s in n.value?(n.value={...n.value},delete n.value[s],n.notify(o,s)):n.value[s]!==r&&(n.value={...n.value,[s]:r},n.notify(o,s))},n};var S=R({isLoaded:!1,client:void 0,user:void 0,session:void 0,organization:void 0}),Y=R(),_=z(null),J=f([S],e=>e.isLoaded),L=q([S,Y],(e,n)=>x(e.isLoaded,{session:e.session,user:e.user,organization:e.organization,client:e.client},n));f([L],e=>e.user);var W=f([L],e=>e.session),w=f([L],e=>e.organization),A=f([S],e=>e.client),X=f([_],e=>e);f([A],e=>e?.sessions);var B=f([A],e=>e?.signIn),G=f([A],e=>e?.signUp),M=(e,n)=>{U(e,()=>{_.get()?.telemetry?.record(Q(n))})};M(B,"$signInStore");M(G,"$signUpStore");M(w,"$organizationStore");export{W as $,J as a,L as b,_ as c,S as d,X as e,Y as f};
